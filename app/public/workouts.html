<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PinkPower | My Workouts</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --pink: #ff4f9a; --dark: #c71585; --bg: #fff0f5; }
        body { font-family: 'Montserrat', sans-serif; background: var(--bg); margin: 0; padding-top: 100px; }
        header { position: fixed; top: 0; width: 100%; height: 80px; background: white; padding: 0 50px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 15px rgba(255, 79, 154, 0.1); z-index: 1000; box-sizing: border-box; }
        .logo { font-size: 1.8rem; font-weight: 900; color: var(--pink); text-transform: uppercase; text-decoration: none; }
        .nav-links { display: flex; gap: 25px; align-items: center; }
        .nav-links a { text-decoration: none; color: #555; font-weight: 700; text-transform: uppercase; font-size: 0.8rem; }
        .btn-create { background: var(--pink); color: white; border: none; padding: 10px 20px; border-radius: 12px; font-weight: 800; cursor: pointer; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; padding: 40px; }
        .set-card { background: white; border-radius: 30px; padding: 25px; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid #ffeef4; }
        .delete-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; color: #ffcad4; cursor: pointer; font-size: 20px; }
        .ex-row { background: #fff9fb; border: 1px dashed #ffcad4; padding: 12px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .ex-name { font-weight: 800; color: #444; font-size: 0.9rem; }
        .coach-tag { background: #fff0f5; color: var(--dark-pink); font-size: 10px; padding: 5px 10px; border-radius: 10px; font-weight: 900; text-transform: uppercase; border: 1px solid #ffcad4; }
    </style>
</head>
<body>

<header>
    <a href="workouts.html" class="logo">PINKPOWER ðŸ’—</a>
    <nav class="nav-links">
        <a href="exercises.html">Library</a>
        <a href="workouts.html" style="color:var(--pink)">My Workouts</a>
        <a href="profile.html">Profile</a>
        <button class="btn-create" onclick="addSet()">+ CREATE SET</button>
    </nav>
</header>

<div class="grid" id="grid"></div>

<script>
    const API = window.location.origin + "/api";
    const token = localStorage.getItem("token");
    let nameMap = {}; 

    async function render() {
        if (!token) {
            document.getElementById("grid").innerHTML = "<h2 style='text-align:center; width:100%; color:#888;'>Please login to see your workouts</h2>";
            return;
        }

        try {
            const exRes = await fetch(API + "/exercises");
            const allEx = await exRes.json();
            allEx.forEach(e => { nameMap[String(e._id)] = e.name; });

            const res = await fetch(API + "/workouts", { 
                headers: { "Authorization": "Bearer " + token }
            });
            const workouts = await res.json();

            const grid = document.getElementById("grid");
            grid.innerHTML = workouts.map(set => {
                const coachInfo = set.trainer?.username || "Personal Program";
                
                return `
                <div class="set-card">
                    <button class="delete-btn" onclick="delSet('${set._id}')">Ã—</button>
                    
                    <div style="margin-bottom: 15px;">
                        <span class="coach-tag">Coach: ${coachInfo}</span>
                    </div>

                    <h2 style="margin:0 0 15px 0; color:var(--dark); font-size:1.1rem; text-transform:uppercase; letter-spacing:1px;">${set.title}</h2>
                    
                    <div>
                        ${(set.exercises || []).map(item => {
                            const id = typeof item === 'string' ? item : (item.exerciseId?._id || item.exerciseId || item);
                            const name = nameMap[String(id)] || "Workout Exercise";
                            return `
                                <div class="ex-row">
                                    <span class="ex-name">ðŸ’ª ${name}</span>
                                    <span style="color:var(--pink); font-weight:900; font-size:10px;">READY</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                `;
            }).join('');
        } catch (e) { 
            console.error("Render Error:", e);
        }
    }

    async function addSet() {
        const title = prompt("Name your training set:");
        if(!title) return;
        
        await fetch(API + "/workouts", {
            method: "POST",
            headers: { 
                "Content-Type": "application/json", 
                "Authorization": "Bearer " + token 
            },
            body: JSON.stringify({ 
                title, 
                description: "User defined workout set",
                level: "beginner"
            })
        });
        render();
    }

    async function delSet(id) {
        if(confirm("Are you sure?")) {
            await fetch(API + "/workouts/" + id, { 
                method: "DELETE", 
                headers: { "Authorization": "Bearer " + token } 
            });
            render();
        }
    }

    render();
</script>
</body>
</html>